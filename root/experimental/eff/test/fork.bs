use experimental:eff;
use test;

effect Fork {
	unsafe effect void fork();
}

handler ForkHandler for Fork {
	handle fork(), k {
		k.call();
		k.call();
	}
}

class Counter {
	Int count;
}

suite ForkTest {
	Counter c;

	handle ForkHandler {
		print("Before");
		Fork:fork();
		print("After");
		c.count++;
	};

	test c.count == 2;
}
