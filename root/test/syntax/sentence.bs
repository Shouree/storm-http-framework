use core:debug;
use core:io;
use core:lang;
use lang:syntax;

// Type for storing a sentence.
class Statement {
	Str noun;
	Str verb;

	ctor(Str noun, Str verb) {
		init() {
			noun = noun;
			verb = verb;
		}
	}

	Str toS() {
		"Statement: " # noun # ", " # verb;
	}
}

void testSimple() on Compiler {
	Str s = "bird";

	Parser<Noun> parser;
	parser.parse(s, Url());
	if (parser.hasError)
		parser.throwError;

	var tree = parser.tree;
	print("Syntax tree: " # tree);

	var tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testSentence() on Compiler {
	// Parse this:
	Str s = "do birds fly?";
	print("Parse: " # s);

	Parser<Sentence> parser;
	parser.parse(s, Url());
	print("Used " # parser.stateCount # " states.");
	print("Used " # parser.byteCount.toBytes);
	if (parser.hasError)
		parser.throwError;

	var tree = parser.tree;
	print("Syntax tree: " # tree);

	var tfm = tree.transform();
	print("Transformed: " # tfm);
}

void testMaybe() on Compiler {
	Str s = "do birds fly?";

	Parser<EmptySentence> parser;
	parser.parse(s, Url());
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	Statement? tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testArray() on Compiler {
	Str s = "do birds fly? do cats sleep?";

	Parser<Paragraph> parser;
	parser.parse(s, Url());
	print("Used " # parser.stateCount # " states.");
	print("Used " # parser.byteCount.toBytes);
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	Statement[] tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testCall() on Compiler {
	Str s = "do birds fly? do cats sleep?";

	Parser<ParCall> parser;
	parser.parse(s, Url());
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	Statement[] tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testCallMaybe() on Compiler {
	Str s = "do birds fly? do cats sleep?";

	Parser<MaybeCall> parser;
	parser.parse(s, Url());
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	Statement[] tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testRaw() on Compiler {
	Str s = "do birds fly? do cats sleep?";

	Parser<RawSentence> parser;
	parser.parse(s, Url());
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	Sentence[] tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testRawCall() on Compiler {
	Str s = "do birds fly? do cats sleep?";

	Parser<RawCall> parser;
	parser.parse(s, Url());
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	Sentence[] tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testCapture() on Compiler {
	Str s = "(fly bird)";

	Parser<Capture> parser;
	parser.parse(s, Url());
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	var tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testRawCapture() on Compiler {
	Str s = "(fly bird)";

	Parser<RawCapture> parser;
	parser.parse(s, Url());
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	var tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testParams() on Compiler {
	Str s = "a : fly bird";

	Parser<PrefixWords> parser;
	parser.parse(s, Url());
	var tree = parser.tree;
	print("Syntax tree: " # tree);
	var tfm = tree.transform;
	print("Transformed: " # tfm);
}

void testEmpty() on Compiler {
	Str s = "()";
	Parser<SParen> parser;
	parser.parse(s, Url());
	print("Used " # parser.stateCount # " states.");
	print("Used " # parser.byteCount.toBytes);
	if (parser.hasError)
		parser.throwError;
}
